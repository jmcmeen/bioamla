# Custom pipeline using included steps
# Demonstrates pipeline.include for step reuse

[pipeline]
name = "custom_with_includes"
description = "Custom pipeline that includes common preprocessing steps"
version = "1.0.0"
author = "bioamla"

[variables]
input_dir = { type = "path", required = true, description = "Raw audio directory" }
output_dir = { type = "path", default = "./custom_output", description = "Output directory" }
sample_rate = { type = "integer", default = 22050, description = "Target sample rate" }

# Include only resample and bandpass steps from common_steps.toml
[[steps]]
name = "preprocess"
action = "pipeline.include"
description = "Include preprocessing steps from common library"
params = { pipeline = "common_steps.toml", steps = ["resample", "bandpass"], variables = { input_dir = "{{ input_dir }}", output_dir = "{{ output_dir }}/preprocess", sample_rate = "{{ sample_rate }}" } }

# Add custom analysis step after preprocessing
[[steps]]
name = "analyze"
action = "analysis.indices"
description = "Calculate acoustic indices on preprocessed audio"
depends_on = ["preprocess"]
params = { input = "{{ output_dir }}/preprocess/filtered", output = "{{ output_dir }}/indices.csv" }

# Log completion
[[steps]]
name = "done"
action = "util.log"
description = "Log completion"
depends_on = ["analyze"]
params = { message = "Custom analysis complete" }
